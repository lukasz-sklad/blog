---
title: Gdy Stable Diffusion WebUI Odmawia WspÃ³Å‚pracy Studium Przypadku z GÅ‚Ä™bokiego Debugowania
description: 'Zobacz, jak krok po kroku rozwiÄ…zaÅ‚em seriÄ™ tajemniczych bÅ‚Ä™dÃ³w podczas instalacji Stable Diffusion WebUI â€“ od problemÃ³w z GPU, przez bÅ‚Ä™dy pamiÄ™ci, aÅ¼ po ostateczny sukces.'
summary: 'stable diffusion automatic1111 debug pytorch gpu cpu lief triton'
date: Listopad November 15 2025
slug: gdy-stable-diffusion-odmawia-wspolpracy
---

# Gdy Stable Diffusion WebUI Odmawia WspÃ³Å‚pracy: Studium Przypadku z GÅ‚Ä™bokiego Debugowania

Stable Diffusion WebUI od AUTOMATIC1111 to potÄ™Å¼ne narzÄ™dzie, ktÃ³re zdemokratyzowaÅ‚o dostÄ™p do generowania obrazÃ³w AI. Pozwala na uruchomienie zaawansowanych modeli na wÅ‚asnym sprzÄ™cie, dajÄ…c niemal nieograniczone moÅ¼liwoÅ›ci twÃ³rcze. Ale co siÄ™ dzieje, gdy po instalacji, zamiast magicznego interfejsu, wita nas czerwony tekst bÅ‚Ä™du w konsoli?

Ostatnio stanÄ…Å‚em przed takim wyzwaniem. Proces, ktÃ³ry miaÅ‚ byÄ‡ prostym uruchomieniem skryptu, zamieniÅ‚ siÄ™ w wieloetapowÄ… bataliÄ™ z bÅ‚Ä™dami. W tym artykule przejdziemy przez caÅ‚Ä… tÄ™ podrÃ³Å¼ â€” od pierwszego komunikatu o bÅ‚Ä™dzie, przez seriÄ™ nieoczekiwanych problemÃ³w, aÅ¼ do ostatecznego sukcesu.

## Etap 1: "Torch is not able to use GPU"

Wszystko zaczÄ™Å‚o siÄ™ od uruchomienia skryptu startowego `./webui.sh`. ChwilÄ™ pÃ³Åºniej pojawiÅ‚ siÄ™ pierwszy, doÅ›Ä‡ jasny komunikat:

```bash
RuntimeError: Torch is not able to use GPU; add --skip-torch-cuda-test to COMMANDLINE_ARGS variable to disable this check
```

**Problem:** Aplikacja wykryÅ‚a, Å¼e biblioteka PyTorch nie jest w stanie komunikowaÄ‡ siÄ™ z procesorem graficznym (GPU), co jest kluczowe dla jej wydajnoÅ›ci.

**RozwiÄ…zanie:** Zgodnie z sugestiÄ…, musiaÅ‚em dodaÄ‡ flagÄ™ `--skip-torch-cuda-test` do argumentÃ³w startowych. W tym projekcie konfiguracjÄ™ uÅ¼ytkownika przechowuje siÄ™ w pliku `webui-user.sh`.

ZmodyfikowaÅ‚em plik `webui-user.sh`, odkomentowujÄ…c i zmieniajÄ…c liniÄ™ `COMMANDLINE_ARGS`:

```bash
# Stara linia
#export COMMANDLINE_ARGS=""

# Nowa linia
export COMMANDLINE_ARGS="--skip-torch-cuda-test"
```

## Etap 2: Pliki wykonywalne i stos pamiÄ™ci (libamdhip64.so)

MyÅ›laÅ‚em, Å¼e to koniec problemÃ³w, ale po ponownym uruchomieniu pojawiÅ‚ siÄ™ znacznie bardziej tajemniczy bÅ‚Ä…d:

```bash
ImportError: libamdhip64.so: cannot enable executable stack as shared object requires: Invalid argument
```

**Problem:** Ten bÅ‚Ä…d dotyczy funkcji bezpieczeÅ„stwa systemu operacyjnego. Biblioteka `libamdhip64.so`, kluczowa dla obsÅ‚ugi kart AMD, wymagaÅ‚a uprawnieÅ„ do wykonywania kodu ze stosu pamiÄ™ci, na co nie pozwalaÅ‚a domyÅ›lna konfiguracja Å›rodowiska (w tym przypadku kontenera).

**RozwiÄ…zanie:** Standardowe narzÄ™dzia jak `execstack` czy `elfedit` zawiodÅ‚y z powodu ograniczeÅ„ Å›rodowiska. RozwiÄ…zaniem okazaÅ‚o siÄ™ uÅ¼ycie biblioteki Pythona o nazwie `lief`, ktÃ³ra pozwala na modyfikacjÄ™ plikÃ³w binarnych. StworzyÅ‚em skrypt `fix_execstack.py`, ktÃ³ry programowo usunÄ…Å‚ flagÄ™ wykonywalnego stosu z wadliwych bibliotek.

Po chwili okazaÅ‚o siÄ™, Å¼e problem dotyczy nie jednego, a kilku plikÃ³w. Skrypt zostaÅ‚ rozszerzony, aby naprawiÄ‡ je wszystkie.

**Skrypt `fix_execstack.py`:**

```python
import lief
import os

def set_nx_bit(filepath):
    try:
        binary = lief.ELF.parse(filepath)
        if binary is None: return

        modified = False
        for segment in binary.segments:
            if segment.has(lief.ELF.Segment.FLAGS.X):
                segment.remove(lief.ELF.Segment.FLAGS.X)
                modified = True

        if modified:
            output_filepath = filepath + "_nx"
            binary.write(output_filepath)
            os.rename(output_filepath, filepath)
            print(f"Naprawiono plik: {filepath}")

    except Exception as e:
        print(f"WystÄ…piÅ‚ bÅ‚Ä…d: {e}")

if __name__ == "__main__":
    files_to_fix = [
        "/home/deck/GIT/ai/stable-diffusion-webui/venv/lib/python3.10/site-packages/torch/lib/libamdhip64.so",
        "/home/deck/GIT/ai/stable-diffusion-webui/venv/lib/python3.10/site-packages/triton/third_party/hip/lib/libamdhip64.so",
        "/home/deck/GIT/ai/stable-diffusion-webui/venv/lib/python3.10/site-packages/torch/lib/libhiprtc.so"
    ]
    for file_path in files_to_fix:
        set_nx_bit(file_path)
```

**Komendy:**

```bash
# Instalacja biblioteki lief
/home/deck/GIT/ai/stable-diffusion-webui/venv/bin/python -m pip install lief

# Uruchomienie skryptu naprawczego
/home/deck/GIT/ai/stable-diffusion-webui/venv/bin/python fix_execstack.py
```

## Etap 3: "Naruszenie ochrony pamiÄ™ci" (Segmentation Fault)

Gdy jeden problem zniknÄ…Å‚, pojawiÅ‚ siÄ™ kolejny, jeszcze groÅºniejszy:

```bash
Naruszenie ochrony pamiÄ™ci (zrzut pamiÄ™ci)
```

**Problem:** To bÅ‚Ä…d typu "segmentation fault", ktÃ³ry oznacza, Å¼e program prÃ³bowaÅ‚ uzyskaÄ‡ dostÄ™p do pamiÄ™ci, do ktÃ³rej nie miaÅ‚ uprawnieÅ„. To bardzo ogÃ³lny bÅ‚Ä…d, trudny do zdiagnozowania.

**RozwiÄ…zanie:** Po wielu prÃ³bach (m.in. dodawanie flag `--no-half` i `--use-cpu all`) kluczowe okazaÅ‚o siÄ™ stworzenie minimalnego skryptu testowego, ktÃ³ry tylko importowaÅ‚ bibliotekÄ™ `torch`. On rÃ³wnieÅ¼ powodowaÅ‚ ten sam bÅ‚Ä…d. To potwierdziÅ‚o, Å¼e problem leÅ¼y w samej instalacji PyTorcha, a nie w aplikacji WebUI.

PostanowiÅ‚em caÅ‚kowicie zmieniÄ‡ wersjÄ™ PyTorcha na takÄ…, ktÃ³ra jest przeznaczona wyÅ‚Ä…cznie dla CPU. To pozwoliÅ‚o ominÄ…Ä‡ potencjalne konflikty ze sterownikami graficznymi.

**Komendy:**

```bash
# Odinstalowanie starej wersji torch
/home/deck/GIT/ai/stable-diffusion-webui/venv/bin/python -m pip uninstall -y torch torchvision torchaudio

# Zmiana w pliku webui-user.sh, aby instalowaÄ‡ wersjÄ™ CPU
export TORCH_COMMAND="pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu"
```

## Etap 4: BrakujÄ…cy moduÅ‚ triton

Po przeinstalowaniu PyTorcha bÅ‚Ä…d krytyczny zniknÄ…Å‚! PojawiÅ‚ siÄ™ za to ostatni, juÅ¼ znacznie prostszy problem:

```bash
ModuleNotFoundError: No module named 'triton.backends'
```

**Problem:** Nowa instalacja PyTorcha wymagaÅ‚a biblioteki `triton`, ktÃ³ra nie zostaÅ‚a automatycznie doinstalowana.

**RozwiÄ…zanie:** RÄ™czna instalacja brakujÄ…cego pakietu.

```bash
/home/deck/GIT/ai/stable-diffusion-webui/venv/bin/python -m pip install triton
```

## Sukces! Jak teraz uruchomiÄ‡ Stable Diffusion WebUI?

Po tej dÅ‚ugiej podrÃ³Å¼y aplikacja jest wreszcie gotowa do startu. Wszystkie problemy zostaÅ‚y rozwiÄ…zane, a konfiguracja jest stabilna.

Aby teraz uruchomiÄ‡ aplikacjÄ™, wystarczy wykonaÄ‡ jednÄ… komendÄ™ w gÅ‚Ã³wnym folderze projektu:

```bash
./webui.sh
```

Aplikacja uruchomi siÄ™ w trybie CPU, co moÅ¼e byÄ‡ wolniejsze niÅ¼ na GPU, ale jest gwarancjÄ… stabilnoÅ›ci, zwÅ‚aszcza w skomplikowanych lub ograniczonych Å›rodowiskach. Interfejs WebUI powinien byÄ‡ dostÄ™pny w przeglÄ…darce pod adresem `http://127.0.0.1:7860`.

<br/>
<button onClick={() => alert("DziÄ™kujÄ™ za przeczytanie artykuÅ‚u o debugowaniu Stable Diffusion WebUI ğŸ‘")}>
  Mam nadziejÄ™, Å¼e ten opis okaÅ¼e siÄ™ pomocny dla kaÅ¼dego, kto natrafi na podobne problemy. Do zobaczenia w nastÄ™pnym wpisie! ğŸ§™â€â™‚ï¸ğŸŒŸ
</button>
